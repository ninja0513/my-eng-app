<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <title>English Spelling Master Pro V14</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@500;700;900&family=Noto+Sans+JP:wght@500;700;900&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #4F46E5; }
        body { 
            font-family: 'Outfit', 'Noto Sans JP', sans-serif; 
            background-color: #F8FAFC; 
            margin: 0; padding: 0;
            overflow: hidden;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        .app-container { 
            height: 100vh;
            height: -webkit-fill-available;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            max-width: 768px; margin: 0 auto; 
            background: #FFFFFF; display: flex; flex-direction: column; 
            position: relative; box-shadow: 0 0 60px rgba(0,0,0,0.12);
        }
        .main-scroll { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .btn-press { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
        .btn-press:active { transform: scale(0.96) translateY(2px); opacity: 0.9; }
        .shake-ui { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } }
        input:focus { font-size: 16px !important; outline: none; border-color: var(--primary) !important; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- „Éó„É≠„Éï„Çß„ÉÉ„Ç∑„Éß„Éä„É´ÂÆåÂÖ®„Éá„Éº„Çø„Éô„Éº„Çπ (191Ë™ûÂÆåÂÖ®Áâà) ---
        const MASTER_DATA = [
            // Session 1: Daily Life (R1-40)
            {id:'R1',word:'Good morning',ja:'„Åä„ÅØ„Çà„ÅÜ'},{id:'R2',word:'Good afternoon',ja:'„Åì„Çì„Å´„Å°„ÅØ'},{id:'R3',word:'Good evening',ja:'„Åì„Çì„Å∞„Çì„ÅØ'},{id:'R4',word:'Good night',ja:'„Åä„ÇÑ„Åô„Åø„Å™„Åï„ÅÑ'},{id:'R5',word:'How are you?',ja:'„ÅäÂÖÉÊ∞ó„Åß„Åô„Åã'},{id:'R7',word:'Nice to meet you',ja:'„ÅØ„Åò„ÇÅ„Åæ„Åó„Å¶'},{id:'R11',word:'look at',ja:'„Äú„ÇíË¶ã„Çã'},{id:'R14',word:'come back',ja:'Êàª„Çã'},{id:'R16',word:'come home',ja:'Â∏∞ÂÆÖ„Åô„Çã'},{id:'R19',word:'go to school',ja:'Â≠¶Ê†°„Å´Ë°å„Åè'},{id:'R20',word:'go home',ja:'ÂÆ∂„Å´Â∏∞„Çã'},{id:'R23',word:'listen to',ja:'„Äú„ÇíËÅû„Åè'},{id:'R24',word:'sit down',ja:'Â∫ß„Çã'},{id:'R25',word:'stand up',ja:'Á´ã„Å§'},{id:'R32',word:'by bus',ja:'„Éê„Çπ„Åß'},{id:'R39',word:'get up',ja:'Ëµ∑„Åç„Çã'},{id:'R40',word:'go to bed',ja:'ÂØù„Çã'},
            // Session 2: Expressions (R41-80)
            {id:'R42',word:'look for',ja:'„Äú„ÇíÊé¢„Åô'},{id:'R49',word:'Here you are',ja:'„ÅØ„ÅÑ„ÄÅ„Å©„ÅÜ„Åû'},{id:'R50',word:'years old',ja:'„ÄúÊ≠≥'},{id:'R52',word:'How many',ja:'„ÅÑ„Åè„Å§„ÅÆ'},{id:'R53',word:'How much',ja:'„ÅÑ„Åè„Çâ„ÅÆ'},{id:'R54',word:'How about',ja:'„Äú„ÅØ„Å©„ÅÜÔºü'},{id:'R61',word:'arrive at',ja:'Âà∞ÁùÄ„Åô„Çã'},{id:'R62',word:'get to',ja:'Âà∞ÁùÄ„Åô„Çã'},{id:'R69',word:'be interested in',ja:'ËààÂë≥„Åå„ÅÇ„Çã'},{id:'R73',word:'be going to',ja:'„Å§„ÇÇ„Çä„Å†'},{id:'R80',word:'have to',ja:'„Åó„Å™„Åë„Çå„Å∞„Å™„Çâ„Å™„ÅÑ'},
            // Session 3: Advanced (R81-120)
            {id:'R81',word:"don't have to",ja:'ÂøÖË¶Å„ÅØ„Å™„ÅÑ'},{id:'R84',word:'for example',ja:'‰æã„Åà„Å∞'},{id:'R90',word:'run away',ja:'ÈÄÉ„Åí„Çã'},{id:'R96',word:'in the future',ja:'Â∞ÜÊù•„ÅØ'},{id:'R103',word:'decide to',ja:'Ê±∫ÂøÉ„Åô„Çã'},{id:'R105',word:'enjoy ~ing',ja:'Ê•Ω„Åó„ÇÄ'},{id:'R108',word:'look forward to',ja:'Ê•Ω„Åó„Åø„Å´ÂæÖ„Å§'},{id:'R111',word:'take care of',ja:'‰∏ñË©±„Çí„Åô„Çã'},{id:'R120',word:'as soon as',ja:'„Åô„Çã„Å®„Åô„Åê„Å´'},
            // Session 4: Phrases (R121-160)
            {id:'R122',word:'like the best',ja:'‰∏ÄÁï™Â•Ω„Åç„Å†'},{id:'R133',word:'each other',ja:'„Åä‰∫í„ÅÑ„Å´'},{id:'R138',word:'grow up',ja:'ÊàêÈï∑„Åô„Çã'},{id:'R144',word:'in front of',ja:'Ââç„Å´'},{id:'R146',word:'on the way to',ja:'Ë°å„ÅèÈÄî‰∏≠„Åß'},{id:'R149',word:'leave a message',ja:'‰ºùË®Ä„ÇíÊÆã„Åô'},{id:'R151',word:'have a good time',ja:'Ê•Ω„Åó„ÇÄ'},{id:'R154',word:'take a walk',ja:'Êï£Ê≠©„Åô„Çã'},{id:'R156',word:'Just a minute',ja:'„Å°„Çá„Å£„Å®ÂæÖ„Å£„Å¶'},
            // Session 5: Basics (Days, Months, Directions)
            {id:'D1',word:'Sunday',ja:'Êó•ÊõúÊó•'},{id:'D2',word:'Monday',ja:'ÊúàÊõúÊó•'},{id:'D3',word:'Tuesday',ja:'ÁÅ´ÊõúÊó•'},{id:'D4',word:'Wednesday',ja:'Ê∞¥ÊõúÊó•'},{id:'D5',word:'Thursday',ja:'Êú®ÊõúÊó•'},{id:'D6',word:'Friday',ja:'ÈáëÊõúÊó•'},{id:'D7',word:'Saturday',ja:'ÂúüÊõúÊó•'},{id:'M1',word:'January',ja:'1Êúà'},{id:'M2',word:'February',ja:'2Êúà'},{id:'M3',word:'March',ja:'3Êúà'},{id:'M4',word:'April',ja:'4Êúà'},{id:'M5',word:'May',ja:'5Êúà'},{id:'M6',word:'June',ja:'6Êúà'},{id:'M7',word:'July',ja:'7Êúà'},{id:'M8',word:'August',ja:'8Êúà'},{id:'M9',word:'September',ja:'9Êúà'},{id:'M10',word:'October',ja:'10Êúà'},{id:'M11',word:'November',ja:'11Êúà'},{id:'M12',word:'December',ja:'12Êúà'},{id:'S1',word:'spring',ja:'Êò•'},{id:'S2',word:'summer',ja:'Â§è'},{id:'S3',word:'fall',ja:'Áßã'},{id:'S4',word:'winter',ja:'ÂÜ¨'},{id:'DIR1',word:'east',ja:'Êù±'},{id:'DIR2',word:'west',ja:'Ë•ø'},{id:'DIR3',word:'south',ja:'Âçó'},{id:'DIR4',word:'north',ja:'Âåó'}
        ];

        function App() {
            const [scene, setScene] = useState('home');
            const [quizList, setQuizList] = useState([]);
            const [qIdx, setQIdx] = useState(0);
            const [input, setInput] = useState('');
            const [isEvaluated, setIsEvaluated] = useState(false);
            const [isCorrect, setIsCorrect] = useState(false);
            const [score, setScore] = useState(0);
            const [stats, setStats] = useState(() => JSON.parse(localStorage.getItem('pro_v14_stats') || '{}'));
            const scrollRef = useRef(null);

            useEffect(() => { localStorage.setItem('pro_v14_stats', JSON.stringify(stats)); }, [stats]);

            const totalAccuracy = useMemo(() => {
                const vals = Object.values(stats);
                if (!vals.length) return 0;
                const tot = vals.reduce((a,c)=>a+c.total, 0);
                return tot > 0 ? Math.round((vals.reduce((a,c)=>a+c.correct, 0) / tot) * 100) : 0;
            }, [stats]);

            const speak = (t) => {
                const u = new SpeechSynthesisUtterance(t);
                u.lang = 'en-US'; u.rate = 0.85;
                window.speechSynthesis.speak(u);
            };

            const startSession = (num) => {
                let pool = [];
                if (num === 1) pool = MASTER_DATA.filter(d => d.id.startsWith('R') && parseInt(d.id.slice(1)) <= 40);
                else if (num === 2) pool = MASTER_DATA.filter(d => d.id.startsWith('R') && parseInt(d.id.slice(1)) > 40 && parseInt(d.id.slice(1)) <= 80);
                else if (num === 3) pool = MASTER_DATA.filter(d => d.id.startsWith('R') && parseInt(d.id.slice(1)) > 80 && parseInt(d.id.slice(1)) <= 120);
                else if (num === 4) pool = MASTER_DATA.filter(d => d.id.startsWith('R') && parseInt(d.id.slice(1)) > 120);
                else pool = MASTER_DATA.filter(d => !d.id.startsWith('R'));

                setQuizList(pool.sort(()=>Math.random()-0.5).slice(0, 10));
                setQIdx(0); setScore(0); setInput(''); setIsEvaluated(false);
                setScene('play');
            };

            const handleCheck = (e) => {
                if (e) e.preventDefault();
                if (isEvaluated || !input.trim()) return;
                const current = quizList[qIdx];
                const target = current.word.toLowerCase().replace(/[?.,!~()]/g, '').trim();
                const correct = input.toLowerCase().trim() === target;
                
                setIsCorrect(correct);
                setIsEvaluated(true);
                if (correct) setScore(s => s + 1);
                speak(current.word);

                setStats(prev => {
                    const d = prev[current.id] || {correct:0, total:0};
                    return {...prev, [current.id]: {correct: correct ? d.correct+1 : d.correct, total: d.total+1}};
                });
            };

            const handleNext = () => {
                if (qIdx + 1 < quizList.length) { setQIdx(v=>v+1); setInput(''); setIsEvaluated(false); }
                else setScene('result');
                if (scrollRef.current) scrollRef.current.scrollTo(0, 0);
            };

            return (
                <div className="app-container">
                    <header className="bg-white border-b px-6 py-4 flex justify-between items-center shrink-0 z-50">
                        <h1 className="text-2xl font-black italic tracking-tighter">ENGLISH <span className="text-indigo-600">PRO V14</span></h1>
                        {scene !== 'home' && <button onClick={()=>setScene('home')} className="text-[10px] font-black bg-slate-100 px-5 py-2 rounded-full btn-press uppercase tracking-widest">Menu</button>}
                    </header>

                    <main className="main-scroll" ref={scrollRef}>
                        {scene === 'home' && (
                            <div className="px-6 py-8 space-y-10 animate-in fade-in duration-500">
                                <section className="bg-indigo-600 p-10 rounded-[3rem] text-white shadow-2xl relative overflow-hidden">
                                    <h2 className="text-xs font-bold opacity-70 uppercase tracking-widest mb-1 italic">Mastery Rank</h2>
                                    <div className="text-8xl font-black italic tracking-tighter">{totalAccuracy}%</div>
                                    <div className="w-full h-3 bg-white/20 rounded-full mt-6 overflow-hidden">
                                        <div className="h-full bg-white transition-all duration-1000 shadow-[0_0_15px_white]" style={{width: `${totalAccuracy}%`}}></div>
                                    </div>
                                    <div className="absolute -right-6 -bottom-10 text-[12rem] font-black opacity-10 italic transform rotate-12 select-none">191</div>
                                </section>

                                <div className="grid gap-5 pb-10">
                                    <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest px-2">Mission Select</p>
                                    {[1,2,3,4,5].map(n => (
                                        <button key={n} onClick={()=>startSession(n)} className="w-full bg-white p-7 rounded-[2.5rem] border-b-8 border-slate-100 border-2 flex justify-between items-center btn-press hover:border-indigo-300 transition-all">
                                            <div className="text-left"><span className="text-[10px] text-indigo-500 font-bold uppercase italic mb-1 block">Course 0{n}</span><div className="text-2xl font-black text-slate-800 italic uppercase">Session {n}</div></div>
                                            <div className="w-14 h-14 bg-indigo-50 rounded-3xl flex items-center justify-center text-indigo-600 font-black">START</div>
                                        </button>
                                    ))}
                                    <button onClick={()=>setScene('dictionary')} className="w-full bg-slate-900 text-white p-8 rounded-[3rem] flex justify-between items-center btn-press shadow-2xl mt-4">
                                        <span className="text-xl font-black italic uppercase">Master Dictionary</span>
                                        <span className="text-3xl">üìö</span>
                                    </button>
                                </div>
                            </div>
                        )}

                        {scene === 'dictionary' && (
                            <div className="px-6 py-10 animate-in slide-in-from-bottom duration-500">
                                <button onClick={()=>setScene('home')} className="text-indigo-600 font-black mb-8 flex items-center gap-2 italic uppercase">‚Üê Back to Base</button>
                                <div className="space-y-4 pb-20">
                                    {MASTER_DATA.map(item => {
                                        const d = stats[item.id] || {correct:0, total:0};
                                        const r = d.total > 0 ? Math.round((d.correct/d.total)*100) : null;
                                        return (
                                            <div key={item.id} className="bg-white p-6 rounded-[2.5rem] border border-slate-100 flex justify-between items-center shadow-sm">
                                                <div>
                                                    <span className="text-[9px] font-black text-slate-300 italic">{item.id}</span>
                                                    <h4 className="text-xl font-black italic text-slate-800">{item.word}</h4>
                                                    <p className="text-xs text-slate-400 font-bold">{item.ja}</p>
                                                </div>
                                                <div className={`px-4 py-2 rounded-full font-black text-[10px] ${r===null?'bg-slate-50 text-slate-300':r>=90?'bg-indigo-600 text-white':'bg-rose-50 text-rose-600'}`}>
                                                    {r!==null?`${r}%`:'NEW'}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {scene === 'play' && (
                            <div className="px-6 py-12 h-full flex flex-col justify-center animate-in zoom-in-95 duration-300">
                                <div className={`text-center space-y-10 ${isEvaluated && !isCorrect ? 'shake-ui' : ''}`}>
                                    <div className="inline-block px-6 py-2 bg-indigo-50 rounded-full text-indigo-600 text-xs font-black uppercase tracking-widest italic">Target {qIdx+1} / 10</div>
                                    <h2 className="text-7xl font-black text-slate-800 italic uppercase leading-tight">{quizList[qIdx].ja}</h2>
                                    
                                    {!isEvaluated ? (
                                        <form onSubmit={handleCheck} className="space-y-8 mt-12">
                                            <input autoFocus type="text" value={input} onChange={(e)=>setInput(e.target.value)} className="w-full py-12 text-5xl text-center font-black rounded-[4rem] bg-slate-50 border-4 border-transparent focus:border-indigo-600 focus:bg-white shadow-2xl transition-all" placeholder="..." autoCapitalize="none" autoCorrect="off" spellCheck="false" />
                                            <button type="submit" className="w-full bg-indigo-600 text-white py-8 rounded-[3rem] font-black text-3xl btn-press shadow-xl uppercase italic">Fire Spell</button>
                                        </form>
                                    ) : (
                                        <div className="space-y-8 mt-12 animate-in zoom-in-95 duration-300">
                                            <div className={`p-14 rounded-[4rem] border-8 shadow-2xl ${isCorrect ? 'bg-emerald-50 border-emerald-200 text-emerald-600 shadow-emerald-100' : 'bg-rose-50 border-rose-200 text-rose-600 shadow-rose-100'}`}>
                                                <p className="text-[10px] font-black uppercase mb-4 tracking-[0.3em] opacity-60">{isCorrect ? 'Perfect' : 'Incorrect'}</p>
                                                <p className="text-7xl font-black italic uppercase leading-none">{quizList[qIdx].word}</p>
                                            </div>
                                            <button onClick={handleNext} className="w-full bg-slate-900 text-white py-10 rounded-[3.5rem] font-black text-4xl btn-press shadow-2xl uppercase italic">Next Mission ‚Üí</button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {scene === 'result' && (
                            <div className="p-8 text-center space-y-12 h-full flex flex-col justify-center animate-in zoom-in-90 duration-500">
                                <h2 className="text-6xl font-black italic uppercase tracking-tighter leading-none">Session<br/>Cleared!</h2>
                                <div className="bg-slate-50 p-16 rounded-[6rem] shadow-inner relative overflow-hidden">
                                    <p className="text-xs font-black text-slate-400 uppercase tracking-[0.3em] mb-4 italic">Performance Score</p>
                                    <div className="text-[14rem] font-black text-indigo-600 leading-none tracking-tighter">{score}<span className="text-5xl text-slate-300 ml-2">/10</span></div>
                                    <div className="absolute top-0 left-0 w-full h-full bg-indigo-600/5 animate-pulse"></div>
                                </div>
                                <div className="space-y-4">
                                    <button onClick={() => {
                                        const msg = `„Çπ„Éö„É™„É≥„Ç∞Â≠¶ÁøíÂ†±Âëä\n„Çπ„Ç≥„Ç¢: ${score}/10\nÁ∑èÂêàÈÅîÊàêÁéá: ${totalAccuracy}%`;
                                        window.location.href=`mailto:?subject=Spelling Report&body=${encodeURIComponent(msg)}`;
                                    }} className="w-full bg-emerald-500 text-white py-8 rounded-[3.5rem] font-black text-3xl btn-press italic uppercase tracking-tighter shadow-lg shadow-emerald-100">Send Report üìß</button>
                                    <button onClick={()=>setScene('home')} className="w-full font-black text-slate-400 py-4 uppercase tracking-[0.2em] italic">Back to Menu</button>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
