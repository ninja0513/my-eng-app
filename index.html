<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="EngMaster">
    
    <link rel="manifest" href="manifest.json">
    
    <title>English Spelling Master Pro V14</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@500;700;900&family=Noto+Sans+JP:wght@500;700;900&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #4F46E5; --success: #10B981; --error: #EF4444; }
        body { 
            font-family: 'Outfit', 'Noto Sans JP', sans-serif; 
            background-color: #F8FAFC; 
            margin: 0; padding: 0;
            /* iOS„ÅÆ„Éê„Ç¶„É≥„ÇπÔºàË∑≥„Å≠Ëøî„ÇäÔºâ„ÇíÊäëÂà∂ */
            position: fixed; width: 100%; height: 100%;
            overflow: hidden;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        .app-container { 
            /* iPhone„ÅÆ„Éé„ÉÉ„ÉÅ„Å®„Éõ„Éº„É†„Éê„Éº„ÇíËÄÉÊÖÆ„Åó„ÅüÈ´ò„ÅïË®≠ÂÆö */
            height: 100vh;
            height: -webkit-fill-available;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            max-width: 768px; 
            margin: 0 auto; 
            background: #FFFFFF; 
            display: flex; 
            flex-direction: column; 
            box-shadow: 0 0 60px rgba(0,0,0,0.07);
        }
        .main-scroll {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .btn-press { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
        .btn-press:active { transform: scale(0.96) translateY(2px); opacity: 0.9; }
        .shake-ui { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
        /* „É¢„Éê„Ç§„É´„Åß„Ç≠„Éº„Éú„Éº„Éâ„ÅåÂá∫„ÅüÊôÇ„Å´„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫„ÅåÂ∞è„Åï„ÅÑ„Å®„Ç∫„Éº„É†„Åó„Å¶„Åó„Åæ„ÅÜ„ÅÆ„ÇíÈò≤„Åê */
        input:focus { font-size: 16px !important; outline: none; border-color: var(--primary) !important; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        const MASTER_DATA = [
            {id:'R1',word:'Good morning',ja:'„Åä„ÅØ„Çà„ÅÜ'},{id:'R5',word:'How are you?',ja:'„ÅäÂÖÉÊ∞ó„Åß„Åô„Åã'},{id:'R7',word:'Nice to meet you',ja:'„ÅØ„Åò„ÇÅ„Åæ„Åó„Å¶'},{id:'R11',word:'look at',ja:'„Äú„ÇíË¶ã„Çã'},{id:'R14',word:'come back',ja:'Êàª„Çã'},{id:'R16',word:'come home',ja:'Â∏∞ÂÆÖ„Åô„Çã'},{id:'R19',word:'go to school',ja:'Â≠¶Ê†°„Å´Ë°å„Åè'},{id:'R20',word:'go home',ja:'ÂÆ∂„Å´Â∏∞„Çã'},{id:'R23',word:'listen to',ja:'„Äú„ÇíËÅû„Åè'},{id:'R24',word:'sit down',ja:'Â∫ß„Çã'},{id:'R25',word:'stand up',ja:'Á´ã„Å§'},{id:'R32',word:'by bus',ja:'„Éê„Çπ„Åß'},{id:'R39',word:'get up',ja:'Ëµ∑„Åç„Çã'},{id:'R40',word:'go to bed',ja:'ÂØù„Çã'},
            {id:'R42',word:'look for',ja:'„Äú„ÇíÊé¢„Åô'},{id:'R49',word:'Here you are',ja:'„ÅØ„ÅÑ„ÄÅ„Å©„ÅÜ„Åû'},{id:'R50',word:'years old',ja:'„ÄúÊ≠≥'},{id:'R52',word:'How many',ja:'„ÅÑ„Åè„Å§„ÅÆ'},{id:'R53',word:'How much',ja:'„ÅÑ„Åè„Çâ„ÅÆ'},{id:'R54',word:'How about',ja:'„Äú„ÅØ„Å©„ÅÜÔºü'},{id:'R61',word:'arrive at',ja:'Âà∞ÁùÄ„Åô„Çã'},{id:'R62',word:'get to',ja:'Âà∞ÁùÄ„Åô„Çã'},{id:'R69',word:'be interested in',ja:'ËààÂë≥„Åå„ÅÇ„Çã'},{id:'R73',word:'be going to',ja:'„Å§„ÇÇ„Çä„Å†'},{id:'R80',word:'have to',ja:'„Åó„Å™„Åë„Çå„Å∞„Å™„Çâ„Å™„ÅÑ'},
            {id:'D1',word:'Sunday',ja:'Êó•ÊõúÊó•'},{id:'D2',word:'Monday',ja:'ÊúàÊõúÊó•'},{id:'D3',word:'Tuesday',ja:'ÁÅ´ÊõúÊó•'},{id:'D4',word:'Wednesday',ja:'Ê∞¥ÊõúÊó•'},{id:'D5',word:'Thursday',ja:'Êú®ÊõúÊó•'},{id:'D6',word:'Friday',ja:'ÈáëÊõúÊó•'},{id:'D7',word:'Saturday',ja:'ÂúüÊõúÊó•'}
        ];

        function App() {
            const [scene, setScene] = useState('home');
            const [quizList, setQuizList] = useState([]);
            const [qIdx, setQIdx] = useState(0);
            const [input, setInput] = useState('');
            const [isEvaluated, setIsEvaluated] = useState(false);
            const [isCorrect, setIsCorrect] = useState(false);
            const [score, setScore] = useState(0);
            const [stats, setStats] = useState(() => JSON.parse(localStorage.getItem('pro_v14_stats') || '{}'));
            const scrollRef = useRef(null);

            useEffect(() => { localStorage.setItem('pro_v14_stats', JSON.stringify(stats)); }, [stats]);

            const totalAccuracy = useMemo(() => {
                const vals = Object.values(stats);
                if (!vals.length) return 0;
                const corr = vals.reduce((a,c)=>a+c.correct, 0);
                const tot = vals.reduce((a,c)=>a+c.total, 0);
                return tot > 0 ? Math.round((corr / tot) * 100) : 0;
            }, [stats]);

            const speak = (t) => {
                const u = new SpeechSynthesisUtterance(t);
                u.lang = 'en-US'; u.rate = 0.85;
                window.speechSynthesis.speak(u);
            };

            const startSession = (num) => {
                let pool = MASTER_DATA.sort(()=>Math.random()-0.5);
                setQuizList(pool.slice(0,10));
                setQIdx(0); setScore(0); setInput(''); setIsEvaluated(false);
                setScene('play');
            };

            const handleCheck = (e) => {
                if (e) e.preventDefault();
                if (isEvaluated || !input.trim()) return;
                const current = quizList[qIdx];
                const target = current.word.toLowerCase().replace(/[?.,!~()]/g, '').trim();
                const correct = input.toLowerCase().trim() === target;
                setIsCorrect(correct);
                setIsEvaluated(true);
                if (correct) setScore(s => s + 1);
                speak(current.word);
                setStats(prev => {
                    const d = prev[current.id] || {correct:0, total:0};
                    return {...prev, [current.id]: {correct: correct ? d.correct+1 : d.correct, total: d.total+1}};
                });
            };

            const handleNext = () => {
                if (qIdx + 1 < quizList.length) { setQIdx(v=>v+1); setInput(''); setIsEvaluated(false); }
                else setScene('result');
                if (scrollRef.current) scrollRef.current.scrollTo(0, 0);
            };

            return (
                <div className="app-container">
                    <div className="bg-white px-6 py-4 flex justify-between items-center shrink-0 border-b">
                        <h1 className="text-xl font-black italic text-slate-800">ENGLISH <span className="text-indigo-600">MASTER</span></h1>
                        {scene !== 'home' && <button onClick={()=>setScene('home')} className="text-[10px] font-black bg-slate-100 px-4 py-2 rounded-full btn-press uppercase tracking-wider">Exit</button>}
                    </div>

                    <div className="main-scroll" ref={scrollRef}>
                        {scene === 'home' && (
                            <div className="px-6 py-8 space-y-8">
                                <div className="bg-indigo-600 p-8 rounded-[2.5rem] text-white shadow-xl relative overflow-hidden">
                                    <div className="relative z-10">
                                        <h2 className="text-xs font-bold opacity-80 uppercase tracking-widest mb-1">Total Accuracy</h2>
                                        <div className="text-6xl font-black italic">{totalAccuracy}%</div>
                                    </div>
                                    <div className="absolute -right-4 -bottom-4 text-9xl font-black opacity-10 italic">PRO</div>
                                </div>

                                <div className="grid gap-4">
                                    {[1,2,3].map(n => (
                                        <button key={n} onClick={()=>startSession(n)} className="w-full bg-white p-6 rounded-3xl border-2 border-slate-100 flex justify-between items-center btn-press hover:border-indigo-200">
                                            <div className="text-left">
                                                <span className="text-[10px] text-indigo-500 font-bold uppercase tracking-tighter">Session</span>
                                                <div className="text-2xl font-black italic text-slate-800">0{n} Challenge</div>
                                            </div>
                                            <div className="w-10 h-10 bg-indigo-50 rounded-full flex items-center justify-center text-indigo-600">‚Üí</div>
                                        </button>
                                    ))}
                                    <button onClick={()=>setScene('dictionary')} className="w-full bg-slate-900 text-white p-6 rounded-3xl flex justify-between items-center btn-press mt-4">
                                        <span className="font-bold italic uppercase">Dictionary üìö</span>
                                    </button>
                                </div>
                            </div>
                        )}

                        {scene === 'play' && (
                            <div className="px-6 py-10 flex flex-col h-full">
                                <div className="text-center space-y-4 mb-10">
                                    <span className="inline-block bg-indigo-50 text-indigo-600 text-[10px] font-bold px-4 py-1 rounded-full uppercase italic">Question {qIdx + 1}/10</span>
                                    <h2 className="text-5xl font-black text-slate-800 italic uppercase">{quizList[qIdx].ja}</h2>
                                </div>
                                
                                {!isEvaluated ? (
                                    <form onSubmit={handleCheck} className="space-y-6">
                                        <input 
                                            autoFocus 
                                            type="text" 
                                            value={input} 
                                            onChange={(e)=>setInput(e.target.value)} 
                                            className="w-full py-8 text-4xl text-center font-black rounded-3xl bg-slate-50 border-4 border-transparent focus:bg-white focus:border-indigo-500 transition-all" 
                                            placeholder="Type here..." 
                                            autoCapitalize="none" autoCorrect="off"
                                        />
                                        <button type="submit" className="w-full bg-indigo-600 text-white py-6 rounded-3xl font-black text-2xl btn-press shadow-lg shadow-indigo-200 uppercase italic">Check Answer</button>
                                    </form>
                                ) : (
                                    <div className="space-y-6 animate-in zoom-in-95">
                                        <div className={`p-10 rounded-[3rem] text-center border-4 ${isCorrect ? 'bg-emerald-50 border-emerald-200 text-emerald-600' : 'bg-rose-50 border-rose-200 text-rose-600'}`}>
                                            <p className="text-xs font-bold uppercase mb-2 tracking-widest">{isCorrect ? 'Correct!' : 'Incorrect'}</p>
                                            <p className="text-5xl font-black italic uppercase leading-tight">{quizList[qIdx].word}</p>
                                        </div>
                                        <button onClick={handleNext} className="w-full bg-slate-900 text-white py-6 rounded-3xl font-black text-2xl btn-press uppercase italic">Next ‚Üí</button>
                                    </div>
                                )}
                            </div>
                        )}

                        {scene === 'result' && (
                            <div className="px-6 py-20 text-center space-y-10">
                                <div>
                                    <div className="text-8xl mb-4">üèÜ</div>
                                    <h2 className="text-4xl font-black italic text-slate-800 uppercase">Clear!</h2>
                                </div>
                                <div className="bg-slate-50 p-10 rounded-[3rem]">
                                    <p className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">Session Score</p>
                                    <div className="text-8xl font-black text-indigo-600 italic">{score}<span className="text-2xl text-slate-300">/10</span></div>
                                </div>
                                <button onClick={()=>setScene('home')} className="w-full bg-indigo-600 text-white py-6 rounded-3xl font-black text-2xl btn-press uppercase italic">Finish</button>
                            </div>
                        )}
                        
                        {scene === 'dictionary' && (
                            <div className="px-6 py-8">
                                <button onClick={()=>setScene('home')} className="text-indigo-600 font-bold mb-6 flex items-center gap-2">‚Üê Back</button>
                                <div className="space-y-3">
                                    {MASTER_DATA.map(item => (
                                        <div key={item.id} className="bg-white p-5 rounded-2xl border border-slate-100 flex justify-between items-center">
                                            <div>
                                                <p className="text-lg font-black italic text-slate-800 leading-none">{item.word}</p>
                                                <p className="text-xs text-slate-400 font-bold">{item.ja}</p>
                                            </div>
                                            <div className="text-[10px] font-black bg-slate-50 text-slate-400 px-3 py-1 rounded-full">{item.id}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        
        // PWAÁî®„ÅÆService WorkerÁôªÈå≤
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').then(() => {
                    console.log('Service Worker Registered');
                });
            });
        }
    </script>
</body>
</html>
